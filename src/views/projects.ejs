<!doctype html>
<html data-theme="cupcake">
<head>
  <meta charset="utf-8" />
  <title><%= title %> · Portfolio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="description" content="Browse Leo Atienza’s projects — repo, live demo, summary, tech stack, tools, and details." />
  <link rel="icon" href="/favicon.ico" />

  <meta property="og:title" content="Projects · Leo Atienza" />
  <meta property="og:description" content="Projects with summaries, tech stacks, tools, and links to GitHub and live demos." />

  <link rel="stylesheet" href="/css/main.css?v=<%= assetVersion %>" />
</head>
<body>
  <%- include('partials/header') %>

  <main class="container mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold mb-6">Projects</h1>

    <!-- Filter (auto-applies on change) -->
    <form id="projectsFilter" method="get" action="/projects" class="mb-6">
      <div class="join">
        <select id="catFilter" class="select select-bordered join-item text-base" name="category">
          <option value="">All categories</option>
          <% categories.forEach(c => { %>
            <option value="<%= c.slug || c.id %>" <%= (selected == (c.slug || c.id)) ? 'selected' : '' %>><%= c.name %></option>
          <% }) %>
        </select>
        <a class="btn join-item text-base" href="/projects">Reset</a>
      </div>
    </form>

    <!-- Grid -->
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <% projects.forEach(p => { %>
        <div class="card bg-base-100 shadow-md hover:shadow-lg transition">
          <div class="card-body">
            <h2 class="card-title">
              <a href="/project/<%= p.slug %>"><%= p.title %></a>
            </h2>

            <% if (p.summary) { %>
              <p class="opacity-80"><%= p.summary %></p>
            <% } %>

            <% if (p.techStack || p.tools) { %>
              <div class="mt-2 space-x-2">
                <% if (p.techStack) { %>
                  <% ('' + p.techStack).split(',').map(s => s.trim()).filter(Boolean).forEach(s => { %>
                    <span class="badge badge-outline"><%= s %></span>
                  <% }) %>
                <% } %>
                <% if (p.tools) { %>
                  <% ('' + p.tools).split(',').map(s => s.trim()).filter(Boolean).forEach(s => { %>
                    <span class="badge"><%= s %></span>
                  <% }) %>
                <% } %>
              </div>
            <% } %>

            <div class="card-actions justify-start mt-3">
              <% if (p.liveUrl) { %>
                <a class="btn btn-primary btn-sm" href="<%= p.liveUrl %>" target="_blank" rel="noopener noreferrer">Live</a>
              <% } %>
              <% if (p.repoUrl) { %>
                <a class="btn btn-ghost btn-sm" href="<%= p.repoUrl %>" target="_blank" rel="noopener noreferrer">Repo</a>
              <% } %>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  </main>

  <script>
    (function () {
      const sel = document.getElementById('catFilter');
      if (!sel) return;
      sel.addEventListener('change', function () {
        // If "All categories", go to /projects (no query)
        if (!this.value) {
          window.location.href = '/projects';
          return;
        }
        // Preserve other query params if present
        const params = new URLSearchParams(window.location.search);
        params.set('category', this.value);
        window.location.href = '/projects?' + params.toString();
      });
    })();
  </script>

  <%- include('partials/footer') %>
</body>
</html>